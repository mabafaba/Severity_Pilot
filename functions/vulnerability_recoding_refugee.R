

refugee_vulnerability_bgd_msna18<-function(hh,ind){
  hhy<-hh
  df<-merge(hhy,ind,by.x="instance_name", by.y= "parent_instance_name", all.x=TRUE) 
  individual_to_hh_aggregation_classification<-df %>%
    mutate(
    work_age=individual_age>=15 & individual_age<=64,
    not_work_age=individual_age<15 & individual_age>64 ,
    over_60=individual_age>=60
  ) %>% 
  group_by(instance_name) %>% 
  summarise(
    sum_working_age=sum(work_age,na.rm = TRUE),
    sum_not_working_age=sum(not_work_age,na.rm = TRUE),
    dependency_ratio=sum(not_work_age,na.rm=TRUE)/sum(work_age,na.rm = TRUE),
    vi.dependency_ratio= ifelse(dependency_ratio>=1.5,1,0),
    vi.over60=ifelse(sum(over_60,na.rm=TRUE)>0,1,0)
  ) %>% 
  select(instance_name,starts_with("vi."))


hh_level_reclassificaiton<-hhy %>% 
  mutate(
    preg_no= ifelse(is.na( anc_group.pregnant_number), 0,anc_group.pregnant_number),
    lact_no= ifelse(is.na( lactating_number), 0,anc_group.pregnant_number),
    vi.preg_lact= ifelse(preg_no+lact_no>0,1,0),
    hh_gen=ifelse(HH_head=="yes", respondent_gender, HH_head_gender),
    vi.female_hoh=ifelse(hh_gen=="female",1,0),
    vi.hh_size= ifelse(hh_size>=6,1,0),
    ) %>% 
  select(instance_name,starts_with("vi."))

dl<-list(individual_to_hh_aggregation_classification,hh_level_reclassificaiton)
all_indis<-Reduce(function(x, y) merge(x, y, all=TRUE), dl)

}
