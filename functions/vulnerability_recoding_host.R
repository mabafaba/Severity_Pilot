
host_vulnerability_bgd_msna18<-function(hh,ind){

  hhy<-hh
  df<-merge(hhy,ind,by.x="instance_name", by.y= "parent_instance_name", all.x=TRUE) 
  individual_to_hh_aggregation_classification<- df %>% 
    mutate(
    grade_num1=ifelse(individual_education=="above_12_tertiary_edu", "13",
                      ifelse(individual_education== "none", "0",individual_education)),
    grade_num2=extract_numeric( grade_num1),
    work_age=(individual_age>=15 & individual_age<=64) %>% as.numeric(),
    not_work_age=(individual_age<15 | individual_age>64 ) %>% as.numeric(),
    over_60=individual_age>=60
  ) %>% 
  group_by(instance_name) %>% 
  summarise(
    vi.highest_grade=max(grade_num2,na.rm=TRUE),
    vi.over60=ifelse(sum(over_60, na.rm = TRUE)>0,1,0),
    sum_working_age=sum(work_age,na.rm = TRUE),
    sum_not_working_age=sum(not_work_age,na.rm = TRUE),
    dependency_ratio=sum(not_work_age,na.rm=TRUE)/sum(work_age,na.rm = TRUE),
    vi.dependency_ratio= ifelse(dependency_ratio>=1.5,1,0),
    vi.preg_lact= ifelse(sum(pregnant_women+lactating_women,na.rm=TRUE)>0,1,0)
    
  ) %>% select(instance_name, starts_with("vi."))


hh_level_reclassificaiton<-hhy %>% 
  mutate(
    hh_gen=ifelse(hh_head=="yes", respondent_gender, hh_gender),
    vi.female_hoh=ifelse(hh_gen=="female",1,0),
    vi.hh_size= ifelse(hh_size>=6,1,0),
    vi.land_own= ifelse(house_land_ownership=="no_dont_own",1,0)
    
    
  ) %>% 
  select(instance_name, starts_with("vi."))

dl<-list(individual_to_hh_aggregation_classification,hh_level_reclassificaiton)
all_indis<-Reduce(function(x, y) merge(x, y, all=TRUE), dl)

}
