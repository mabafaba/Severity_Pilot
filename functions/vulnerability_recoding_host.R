
#######################################
#FUNCTIONS

library(tidyr)

#I - HOST COMMUNITY
###################
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
hh<-read.csv("../02_Data/HC_HH_Data.csv", stringsAsFactors = FALSE, na.strings = c(""," ", NA))
ind<-read.csv("../02_Data/HC_Indiv_Data.csv", stringsAsFactors = FALSE, na.strings = c(""," ", NA))

nrow(hh)

hhy<-hh[hh$survey_consent=="yes",] #only eligible
df$pregnant_women
df$lactating_women
hhy$pregnant_women
hhy$lactating_women
work_age=individual_age>=15 & individual_age<=64,
not_work_age=individual_age<15 & individual_age>64 ,
over_60=individual_age>=60
) %>% 
  group_by(instance_name) %>% 
  summarise(
    sum_working_age=sum(work_age,na.rm = TRUE),
    sum_not_working_age=sum(not_work_age,na.rm = TRUE),
    
df<-merge(hhy,ind,by.x="instance_name", by.y= "parent_instance_name", all.x=TRUE) 
df %>% 
  mutate(
    grade_num1=ifelse(individual_education=="above_12_tertiary_edu", "13",
                      ifelse(individual_education== "none", "0",individual_education)),
    grade_num2=extract_numeric( grade_num1),
    work_age=individual_age>=15 & individual_age<=64,
    not_work_age=individual_age<15 & individual_age>64 ,
    sum_working_age=sum(work_age,na.rm = TRUE),
    sum_not_working_age=sum(not_work_age,na.rm = TRUE),
    dependency_ratio=sum(not_work_age,na.rm=TRUE)/sum(work_age,na.rm = TRUE),
    vi.dependency_ratio= ifelse(dependency_ratio>=1.5,1,0)
  ) %>% 
  group_by(instance_name) %>% 
  summarise(
    highest_grade=max(grade_num2,na.rm=TRUE)
  )

hhy$hh_head
hhy$respondent_gender
hhy$hh_gender
hhy$hh_size
hhy %>% 
  mutate(

    vi.preg_lact= ifelse(sum(pregnant_women+lactating_women,na.rm=TRUE)>0,1,0),
    hh_gen=ifelse(hh_head=="yes", respondent_gender, hh_gender),
    vi.female_hoh=ifelse(hh_gen=="female",1,0),
    vi.hh_size= ifelse(hh_size>=6,1,0),
    
    
  )
df$spend_communication
df$individual_education %>% unique()
